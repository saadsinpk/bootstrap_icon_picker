<!DOCTYPE html>
<html>

<head>
    <title>FOnt Select</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <link href="dist/css/fontawesome-iconpicker.min.css" rel="stylesheet">
    <style>
    .fade.in {
        opacity: 1;
    }

    .popover-header {
        -js-display: flex;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        align-items: center;
        justify-content: space-between;
    }

    .popover-close {
        cursor: pointer;
    }
    [data-bs-toggle="popover"] i.fas {
        display: none;
    }
    .dropdown-menu.iconpicker-container {
        top: 50px;
        left: -0.9rem;
    }

    .popover {
          position: absolute !important;
          top: 20px !important;
          left: 30px !important;

        }

    .buttonEditor {
        padding-right: 10px;
    }

    </style>
</head>

<body>
    <br><br><br><br>
    <div class="container">
        <div class="row">
            <div class="col-sm-9">
                <div id="buttonSection1" class="d-flex flex-wrap">
                    <span id="testButton123" class="buttonEditor">
                        <span id="editorICONtestButtonSpan123">
                            <a tabindex="0" id="buttonTop123" class="buttonPopover" role="button" data-html="true" data-bs-toggle="popover" title="<b>Button Controls</b><i class='popover-close fas fa-times'></i>" data-bs-content="<div>
                              <b>Select icomn</b>
                                <div class='input-group mb-3 div_icon'>
                                    <div class='input-group-prepend'>
                                        <span class='input-group-text h-100 selected-icon icpchange' data-id='123'></span>
                                    </div>
                                    <input type='text' class='icp form-control iconpicker'>
                              </div>
                              <br>
                              <b>Button Text</b>
                              <input type='text' onkeyup='buttonText(123)' id='newButtonText123' class='btn_text form-control' value='Click Here'>
                              <br>
                              <b>Select Target</b>
                              <select id='newButtonTarget123' class='btn_target form-control'>
                                  <option>none</option>
                                  <option>_blank</option>
                                  <option>_parent</option>
                              </select>
                              <br>
                              <b>Button Link</b>
                              <input type='text' id='newButtonLink123' onkeyup='buttonHref(123)' class='btn_link form-control' placeholder='https://google.com'>
                              <br>
                              <a href='#' class='popover-close' onclick='deleteButton(123);return false;'>Delete Button</a>
                          </div>"><i class="fas fa-edit editorICONtestButton123"></i></a>
                        </span>
                        <a href="#" id="buttonHref123" class="main_link btn btn-warning btn-lg"><i class="picker-target bi bi-alarm" id="buttonIcon123"></i> <span id="buttonText123">Click Here</span></a>
                    </span>
                </div>
            </div>
        </div>
    </div>

<br><br>
 <center><a href='#' onclick='newButton(1);return false;'>New Button</a></center>


    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="dist/js/fontawesome-iconpicker.js"></script>
    <script>
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function(popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl, {
            container: 'body',
            title: 'Search',
            html: true,
            placement: 'bottom',
            sanitize: false,
        })
    });

      function newButton(buttonSection) {
        
        var rand1 = Math.floor(Math.random() * 90000) + 10000;
    
        var newID = buttonSection + '000' + rand1;

        ///var myDiv = document.createElement('div');
        ///document.body.appendChild(myDiv);

        /// ' + time + \'\' + rand'
            
        var newButtonHtml = '<span id="testButton'+ newID +'" class="buttonEditor">'+
                    '<span id="editorICONtestButtonSpan'+ newID +'">'+
                        '<a tabindex="0" id="buttonTop'+ newID +'" class="buttonPopover" role="button" data-html="true" data-bs-toggle="popover" title="<b>Button Controls</b><i class=\'popover-close fas fa-times\'></i>" data-bs-content="<div>'+
   '<b>Select icomn</b>'+
    '<div class=\'input-group mb-3 div_icon\'>'+
        '<div class=\'input-group-prepend\'>'+
            '<span class=\'input-group-text h-100 selected-icon icpchange\' data-id=\''+newID+'\'></span>'+
        '</div>'+
        '<input type=\'text\' class=\'icp form-control iconpicker\'>'+
    '</div>'+
   '<br>'+
   '<b>Button Text</b>'+
   '<input type=\'text\' onkeyup=\'buttonText('+ newID +')\' id=\'newButtonText'+ newID +'\' class=\'btn_text form-control\' value=\'Click Here\'>'+
   '<br>'+
   '<b>Select Target</b>'+
   '<select id=\'newButtonTarget'+ newID +'\' class=\'btn_target form-control\'>'+
    '<option>none</option>'+
    '<option>_blank</option>'+
    '<option>_parent</option>'+
   '</select>'+
   '<br>'+
   '<b>Button Link</b>'+
   '<input type=\'text\' id=\'newButtonLink'+ newID +'\' onkeyup=\'buttonHref('+ newID +')\' class=\'btn_link form-control\' placeholder=\'https://google.com\'>'+
   '<br>'+
      '<a href=\'#\' class=\'popover-close\' onclick=\'deleteButton('+ newID +');return false;\'>Delete Button</a>'+
'</div>"><i class="fas fa-edit editorICONtestButton'+ newID +'"></i></a></span>'+
                    '<a href="#" id="buttonHref'+ newID +'" class="main_link btn btn-warning btn-lg"><i class="picker-target bi bi-alarm" id="buttonIcon'+ newID +'"></i> <span id="buttonText'+ newID +'">Click Here</span></a>'+
                '</span>';

        ///let finalNewButtonHtml = newButtonHtml.replaceAll('55555', newID);
        document.getElementById('buttonSection' + buttonSection).innerHTML += newButtonHtml;
        ///$('#buttonSection' + buttonSection).append(finalNewButtonHtml);
    }

    function deleteButton(buttonID) {
        var myobj = document.getElementById("testButton"+buttonID);
        myobj.remove();
    }

    function buttonText(buttonID) {
        var newButtonText = document.getElementById('newButtonText' + buttonID).value;
        document.getElementById("buttonText" + buttonID).textContent = newButtonText;
    }

    function buttonHref(buttonID) {
        var newButtonLink = document.getElementById('newButtonLink' + buttonID).value;
        $("#buttonHref" + buttonID).attr('href', newButtonLink);
    }

    function buttonTarget(buttonID) {
        var newButtonLink = document.getElementById('newButtonLink' + buttonID).value;
        $("#buttonHref" + buttonID).attr('href', newButtonLink);
    }

    $(function() {       

        $(document).on("mouseenter", ".buttonEditor", function() {

            $('.popover').popover('hide');            

            var buttonID = $(this).attr('id');

            var idNumber = buttonID.replace(/\D/g, '');


            // $('#editorICONtestButtonSpan' + idNumber).fadeIn();
            $('#buttonTop' + idNumber).popover({
              container: 'body',
              title: 'Search',
              html: true,
              placement: 'bottom',
              sanitize: false,
            });
            $('#buttonTop' + idNumber).popover('show');

            (async () => {
                var buttonHref = $('#buttonHref' + idNumber).attr('data-iconpicker');
                if(buttonHref === '' || buttonHref === undefined) {
                    buttonHref = 'bi-alarm';
                }

                var count_DropDown = $(".iconpicker-dropdown").length;
                if(count_DropDown == 0) {
                    const response = await fetch('dist/iconsets/bootstrap5.json')
                    const result = await response.json();
                    new Iconpicker(document.querySelector(".iconpicker"), {
                        icons: result,
                        showSelectedIn: document.querySelector(".div_icon .selected-icon"),
                        searchable: true,
                        selectedClass: "selected",
                        containerClass: "my-picker",
                        hideOnSelect: true,
                        fade: true,
                        defaultValue: buttonHref,
                        valueFormat: val => `bi ${val}`
                    });

                    $('#buttonHref' + idNumber).attr('data-iconpicker', buttonHref);
                }

            })()

        });


        $(document).on("mouseleave", ".buttonEditor", function() {

            var buttonID = $(this).attr('id');

            var idNumber = buttonID.replace(/\D/g, '');

            // $('#editorICONtestButtonSpan' + idNumber).slideUp();

        });


    $(document).on("mouseleave", ".popover", function() {

            var buttonID = $(this).attr('id');
           $(this).closest('.popover').popover('hide');            

            // $('#editorICONtestButtonSpan' + idNumber).slideUp();

        });

       

        $(document).on('change', '.btn_target', function(e) {

            idNumber = $(this).attr('id');
            var idNumber = idNumber.replace(/\D/g, '');
            if ($('#newButtonTarget' + idNumber).val() == "none") {
                $('#buttonHref' + idNumber).removeAttr('target');
            } else {
                $('#buttonHref' + idNumber).attr('target', $('.btn_target').val());
            }
            
        });
        $(document).on('DOMSubtreeModified', '.icpchange', function(e) {
            var append_html = $(this).html();
            var icon_name = append_html.replace('<i class="', '');
            icon_name = icon_name.replace('"></i>', '');

            var idNumber = $(this).attr('data-id');
            class_idNumber = "buttonIcon"+idNumber;
            if(append_html != '') {
                $('#buttonHref' + idNumber).attr('data-iconpicker', icon_name);
                append_html = append_html.replace("><", " id='"+class_idNumber+"'><");
                $("#"+class_idNumber).replaceWith(append_html);
            }
        });
        $(document).on('click', '.popover .popover-close', function() {
            $(this).closest('.popover').popover('hide');            
        });
        $(document).on('click', '.dropdown-toggle', function(e){
            $(this).parent().find('.dropdown-menu.iconpicker-container').fadeToggle();
        });
        $(document).on('click', '.iconpicker .iconpicker-item', function(e){
            $(this).closest('.dropdown-menu.iconpicker-container').fadeToggle();
        });


    });
    </script>
    <script src="dist/iconpicker.js"></script>

</body>

</html>